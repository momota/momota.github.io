---
layout: post
title: "rbenv でrubyバージョンにはもう泣かされない"
date: 2013-08-25 22:06
comments: true
categories: ruby rbenv mac 
---
ソフトウェアバージョンの差異に悩まされる人は多いと思う。

同じOS上で違うバージョンのrubyを動かしたいことはまあある。
`/home/you/foo`以下は既存コードがあるから1.8系のままでで動かしたいし、`/home/you/bar`以下は新しい試みとして2.0系を動かしたいとか。
そこでrbenvという便利なrubyバージョン管理ツールがある。
rbenvにより、あるディレクトリ以下のrubyバージョンを任意に指定できる。

<!-- more -->

## rbenv をインストールする

詳細はgithubの`README.md`参照。https://github.com/sstephenson/rbenv


### 1. 最新コードをローカルにチェックアウトする

githubから最新版を `~/.rbenv` にチェックアウトする

```sh
$ git clone https://github.com/sstephenson/rbenv.git ~/.rbenv
```


### 2. pathを通すため、shellの設定を変更する

- `~/.rbenv/bin` を `$PATH` に追加する

```sh
$ echo 'export PATH="$HOME/.rbenv/bin:$PATH"' >> ~/.zshrc
```

- shim と 自動補完を有効にする

```sh
$ echo 'eval "$(rbenv init -)"' >> ~/.zshrc
```

bash ユーザは `~/.zshrc` の代わりに `~/.bash_profile` へ。
ubuntu ユーザは `~/.zshrc` の代わりに `~/.profile` へ。



### 3. 設定変更内容を反映するため、shell を再起動する

```sh
$ exec $SHELL -l
```


### (番外編) rbenv を最新版にアップグレードする

```sh
$ cd ~/.rbenv
$ git pull
```

## ruby-build をインストールして、任意の ruby バージョンをインストールできるようにする

`ruby-build` は rbenv のプラグインで、いろいろなバージョンの ruby のインストールを `rbenv install` コマンドでできるようになる。
インストールは、[公式に書いてあるように以下。](https://github.com/sstephenson/ruby-build)

```sh
$ git clone https://github.com/sstephenson/ruby-build.git ~/.rbenv/plugins/ruby-build
```

MAC使いだと homebrew でいける。

```sh
$ brew install ruby-build
```

### インストール可能な ruby バージョンを一覧表示する

```sh
$ rbenv install -l
```

### 任意のバージョンの ruby をインストールする

```sh
$ rbenv install 1.9.3-pxx
```

### ruby-build を upgrade する

新しいバージョンの ruby が公開されたりすると、ruby-build を upgrade する必要がある。
`git pull` してあげれば良い。

```sh
$ cd ~/.rbenv/plugins/ruby-build/
$ git pull origin master
```




 
## rbenv で任意バージョンの ruby へ切り替えたり

```sh
# List all Ruby versions known by rbenv
$ rbenv versions

# switch version
$ rbenv global 1.9.3-pxx

# back to system default
$ rbenv global system


# 特定のディレクトリ以下のRubyバージョンを切り替え
$ rbenv local 1.9.3-p327

# ローカル設定を解除
$ rbenv local --unset


# path to installed ruby or gem
$ rbenv rehash
```

